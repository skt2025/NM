<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Negotiation Dashboard – Colorful (Complete)</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    html, body { height: 100%; margin: 0; }
    @media print {
      .print-dump { display: block !important; break-inside: avoid; page-break-inside: avoid; }
      .screen-only { display: none !important; }
      .print-only  { display: block !important; }
      body { background: #ffffff !important; color: #000000 !important; }
    }
    .print-only { display: none; }
    .print-dump { display: none; }
    #fatal { position: fixed; inset: 0; background: #141427; color: #fff; display: none; align-items: center; justify-content: center; padding: 24px; z-index: 99999; }
    #fatal .box { max-width: 900px; width: 100%; background: #1e1e2f; border-radius: 12px; border: 1px solid #444; padding: 16px 20px; font-family: ui-sans-serif, system-ui; }
    #fatal .title { font-weight: 700; font-size: 18px; margin-bottom: 6px; color: #fca5a5; }
    #fatal .msg { font-size: 14px; opacity: 0.9; white-space: pre-wrap; }
  </style>
</head>
<body class="min-h-screen bg-[#0c1027] text-white">
  <div id="root"></div>
  <div id="fatal"><div class="box"><div class="title">A script error occurred</div><div id="fatal-msg" class="msg"></div></div></div>
  <!-- React 18 -->
  <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>

  <!-- Framer Motion (with fallback) -->
  <script>
    (function loadFramerMotion(){
      function alias(){ if (!window.framerMotion && window.FramerMotion) window.framerMotion = window.FramerMotion; }
      var s = document.createElement('script');
      s.src = 'https://cdn.jsdelivr.net/npm/framer-motion@11/dist/framer-motion.umd.js';
      s.crossOrigin = 'anonymous';
      s.onload = alias;
      s.onerror = function(){
        var f = document.createElement('script');
        f.src = 'https://unpkg.com/framer-motion@11.0.0/dist/framer-motion.umd.js';
        f.crossOrigin = 'anonymous';
        f.onload = alias;
        document.head.appendChild(f);
      };
      document.head.appendChild(s);
    })();
  </script>

  <!-- html2canvas & jsPDF -->
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>

  <!-- Babel for JSX -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <script type="text/babel">
    const { useState, useRef, useEffect, useLayoutEffect, useCallback } = React;

  const THEME = {
  panelA: "#000000",
  panelB: "#000000",
  panelC: "#b8b8b8",
  cream:  "#f8f8f8",
  blue:   "#3b5998",
  green:  "#4b7b4b",
  pink:   "#b56576",
  orange: "#d49a6a",
  violet: "#6a5acd",
  ink:    "#000000",
  ink2:   "#222222",
  dark:   "#000000",
  mid:    "#999999",
  light:  "#efefef"
};


    function showFatal(msg){
      const box = document.getElementById('fatal');
      const m = document.getElementById('fatal-msg');
      if (box && m){ box.style.display = 'flex'; m.textContent = msg; }
    }

    function ensureFramerReady(maxWaitMs = 3500) {
      const start = Date.now();
      return new Promise((resolve, reject) => {
        (function check(){
          const fm = window.framerMotion || window.FramerMotion;
          if (fm && fm.motion) return resolve(fm);
          if (Date.now() - start > maxWaitMs) return reject(new Error('Framer Motion failed to load (timeout)'));
          setTimeout(check, 40);
        })();
      });
    }

    ensureFramerReady().then((fm) => { startApp(fm.motion, false); })
    .catch((err) => {
      console.warn('Framer Motion failed; enabling no-animations shim:', err);
      function createMotion(tag){
        return React.forwardRef((props, ref) => {
          const { initial, animate, exit, whileTap, whileHover, transition, variants, layout, layoutId, ...rest } = props || {};
          return React.createElement(tag, { ...rest, ref }, props && props.children);
        });
      }
      const motionShim = new Proxy({}, { get: (_, tag) => createMotion(tag) });
      window.framerMotion = { motion: motionShim };
      startApp(motionShim, true);
    });

    function startApp(motion, noAnimMode) {
      if (!motion) { showFatal('motion component unavailable'); return; }

      function useStrategyData(initial){
        const [stages, setStages] = useState(initial);
        const updateStage = (i, patch) => setStages(prev => prev.map((s, idx) => (idx === i ? { ...s, ...patch } : s)));
        const renameSub = (i, oldKey, newKey) => setStages(prev => prev.map((s, idx) => {
          if (idx !== i || !newKey || newKey === oldKey) return s;
          const { [oldKey]: val, ...rest } = s.subs;
          return { ...s, subs: { ...rest, [newKey]: val } };
        }));
        const updateSubItems = (i, key, items) => setStages(prev => prev.map((s, idx) => (idx === i ? { ...s, subs: { ...s.subs, [key]: items } } : s)));
        return { stages, setStages, updateStage, renameSub, updateSubItems };
      }

      function NegotiationMachineRetroTV({ stages, goalsTabs, setGoalsTabs }) {
        const [idx, setIdx] = useState(0);
        const [subIdx, setSubIdx] = useState(0);
        const [activeGoalsTab, setActiveGoalsTab] = useState(0);
	const tabInfoTexts = [
  'Enter the details of Tab 1 here',
  'Enter the details of Tab 2 here',
  'Enter the details of Tab 3 here',
  'Enter the details of Tab 4 here',
  'Enter the details of Tab 5 here',
  'Enter the details of Tab 6 here',
  'Enter the details of Tab 7 here',
];

        if (!stages || stages.length === 0) {
          return (
            <div className="min-h-[40vh] w-full flex items-center justify-center bg-[#F5F3E7] p-6 rounded-2xl">
              <p className="text-[#2c2c40] text-center">No Strategy Data found. Add content in STRATEGY DATA to begin.</p>
            </div>
          );
        }

        const currentStage = stages[idx % stages.length];
        const subKeys = Object.keys(currentStage.subs || {});
        useEffect(() => { if (subIdx >= subKeys.length) setSubIdx(0); }, [subKeys.length, subIdx]);
        const currentSub = subKeys[subIdx % Math.max(1, subKeys.length)];
        const subItems = (currentStage.subs || {})[currentSub] || [];

        const mainTickCount = stages.length;
        const subTickCount = subKeys.length || 1;
        const baseAngle = -90;

        const [animatedMainAngle, setAnimatedMainAngle] = useState(baseAngle);
        const [animatedSubAngle, setAnimatedSubAngle] = useState(baseAngle);
        const shortestStep = (current, target) => { const delta = ((target - current + 540) % 360) - 180; return current + delta; };
        useEffect(() => { const target = baseAngle + (360 / mainTickCount) * (idx % mainTickCount); setAnimatedMainAngle((cur) => shortestStep(cur, target)); }, [idx, mainTickCount]);
        useEffect(() => { const target = baseAngle + (360 / subTickCount) * (subIdx % subTickCount); setAnimatedSubAngle((cur) => shortestStep(cur, target)); }, [subIdx, subTickCount]);

        const next = () => setIdx((p) => (p + 1) % mainTickCount);
        const prev = () => setIdx((p) => (p - 1 + mainTickCount) % mainTickCount);
        const nextSub = () => setSubIdx((p) => (p + 1) % subTickCount);
        const prevSub = () => setSubIdx((p) => (p - 1 + subTickCount) % subTickCount);

        const exportRef = useRef(null);

        const handleExportPDF = useCallback(async () => {
  const { jsPDF } = window.jspdf;
  const pdf = new jsPDF({ orientation: 'portrait', unit: 'pt', format: 'a4' });

  // Colors and typography as per the professional layout
  const C = {
    headerBg: [18, 36, 59],
    headerText: [255, 255, 255],
    titleText: [18, 36, 59],
    bodyText: [26, 26, 26],
    panelBg: [247, 249, 252],
    accent: [26, 141, 162],
    rule: [210, 216, 222],
    footerText: [90, 100, 110]
  };

  const margin = 48;
  const pageW = pdf.internal.pageSize.getWidth();
  const pageH = pdf.internal.pageSize.getHeight();
  const maxW = pageW - margin * 2;
  const lineH = 14;

  function drawHeader() {
    pdf.setFillColor(...C.headerBg);
    pdf.rect(0, 0, pageW, 64, 'F');

    const title = 'Negotiation Machine';
    const subtitle = 'Consolidated notes from dashboard tabs';

    // Centered title/subtitle
    pdf.setTextColor(...C.headerText);
    pdf.setFont('helvetica', 'bold'); pdf.setFontSize(14);
    const tw = pdf.getTextWidth(title);
    pdf.text(title, (pageW - tw) / 2, 34);

    pdf.setFont('helvetica', 'normal'); pdf.setFontSize(10);
    const sw = pdf.getTextWidth(subtitle);
    pdf.text(subtitle, (pageW - sw) / 2, 50);
  }

  function drawFooter(pageNo) {
    pdf.setDrawColor(...C.rule);
    pdf.setLineWidth(0.6);
    pdf.line(margin, pageH - 34, pageW - margin, pageH - 34);

    pdf.setTextColor(...C.footerText);
    pdf.setFont('helvetica', 'normal'); pdf.setFontSize(9);

    const ts = new Date();
    const pad = n => String(n).padStart(2, '0');
    const mon = ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];
    const stamp = `${pad(ts.getDate())} ${mon[ts.getMonth()]} ${ts.getFullYear()}, ${pad(ts.getHours())}:${pad(ts.getMinutes())}`;

    pdf.text('Prepared for internal use', margin, pageH - 18);
    const right = `Generated: ${stamp}  •  Page ${pageNo}`;
    pdf.text(right, pageW - margin - pdf.getTextWidth(right), pageH - 18);
  }

  function wrap(text, width) {
    const body = (text && text.trim()) ? text : '(no notes entered)';
    return pdf.splitTextToSize(body, width);
  }

  function addPanel(title, text, yStart, pageNoRef) {
    const innerPad = 10, accentW = 4;

    pdf.setFont('helvetica', 'normal'); pdf.setFontSize(11);
    const bodyLines = wrap(text, maxW - innerPad * 2 - accentW - 2);

    const titleH = 16;
    const blockH = innerPad + titleH + 6 + bodyLines.length * lineH + innerPad;

    // Page break if needed
    if (yStart + blockH > pageH - 40) {
      drawFooter(pageNoRef.no);
      pdf.addPage('a4', 'portrait'); pageNoRef.no += 1; drawHeader();
      yStart = 64 + 18;
    }

    // Panel
    pdf.setFillColor(...C.panelBg);
    if (pdf.roundedRect) pdf.roundedRect(margin, yStart, maxW, blockH, 6, 6, 'F');
    else pdf.rect(margin, yStart, maxW, blockH, 'F');

    // Accent
    pdf.setFillColor(...C.accent);
    pdf.rect(margin, yStart, accentW, blockH, 'F');

    // Title
    pdf.setTextColor(...C.titleText);
    pdf.setFont('helvetica', 'bold'); pdf.setFontSize(12);
    pdf.text(title, margin + accentW + innerPad, yStart + innerPad + 12);

    // Rule
    pdf.setDrawColor(...C.rule); pdf.setLineWidth(0.6);
    pdf.line(margin + accentW + innerPad, yStart + innerPad + 18, margin + maxW - innerPad, yStart + innerPad + 18);

    // Body
    pdf.setTextColor(...C.bodyText);
    pdf.setFont('helvetica', 'normal'); pdf.setFontSize(11);

    let yy = yStart + innerPad + 18 + 8;
    for (const ln of bodyLines) {
      if (yy > pageH - 40) {
        drawFooter(pageNoRef.no);
        pdf.addPage('a4', 'portrait'); pageNoRef.no += 1; drawHeader();
        yy = 64 + 18 + innerPad + 18 + 8;
      }
      pdf.text(ln, margin + accentW + innerPad, yy);
      yy += lineH;
    }

    return yStart + blockH + 10;
  }

  // 1) TABS-ONLY PAGES (professional layout)
  let pageNoRef = { no: 1 };
  drawHeader();
  let y = 64 + 18;

  // Use your existing tab headings from tabInfoTexts for titles
  for (let i = 0; i < 7; i++) {
    const raw = (typeof tabInfoTexts !== 'undefined' && tabInfoTexts[i]) ? String(tabInfoTexts[i]).trim() : '';
    const panelTitle = raw.length ? raw : `Tab ${i + 1}`;
    const text = goalsTabs[i] || '';
    y = addPanel(panelTitle, text, y, pageNoRef);
  }

  drawFooter(pageNoRef.no);

  // 2) APPEND A FULL-PAGE SCREENSHOT OF THE DASHBOARD
  //    Uses your existing exportRef container and html2canvas already on the page. :contentReference[oaicite:1]{index=1}
  const node = exportRef.current;
  if (node) {
    // New page in landscape to fit the dashboard nicely
    pdf.addPage('a4', 'landscape');

    // Capture as seen on screen; keep existing gradients (no forced background)
    const canvas = await window.html2canvas(node, {
  backgroundColor: null,
  scale: 2,
  useCORS: true,
  ignoreElements: (el) => el.closest('[data-snap="off"]') !== null
});

    const img = canvas.toDataURL('image/png');

    const pw = pdf.internal.pageSize.getWidth();
    const ph = pdf.internal.pageSize.getHeight();
    const snapMargin = 24;
    const availW = pw - snapMargin * 2;
    const availH = ph - snapMargin * 2;

    // Fit and center on the page
    const ratio = Math.min(availW / canvas.width, availH / canvas.height);
    const w = canvas.width * ratio;
    const h = canvas.height * ratio;
    const x = (pw - w) / 2;
    const yImg = (ph - h) / 2;

    pdf.addImage(img, 'PNG', x, yImg, w, h);
  }

  // 3) SAVE
  pdf.save('negotiation_tabs_plus_screenshot.pdf');
}, [goalsTabs]);




        const handlePrint = useCallback(() => window.print(), []);

        // Geometry for ticks
        const mainDialRef = useRef(null);
        const subDialRef = useRef(null);
        const [radii, setRadii] = useState({ main: 0, sub: 0 });
        useLayoutEffect(() => {
          const ro = new ResizeObserver(() => {
            const m = mainDialRef.current?.getBoundingClientRect();
            const s = subDialRef.current?.getBoundingClientRect();
            setRadii({ main: m ? Math.min(m.width, m.height) / 2 : 0, sub: s ? Math.min(s.width, s.height) / 2 : 0 });
          });
          if (mainDialRef.current) ro.observe(mainDialRef.current);
          if (subDialRef.current) ro.observe(subDialRef.current);
          return () => ro.disconnect();
        }, []);
        const borderWidth = 6; const desiredInset = 18;
        const tickDistance = (dial, h) => { const r = dial === 'main' ? radii.main : radii.sub; if (!r) return 0; return r - borderWidth - desiredInset - h / 2; };


        return (
          <div className="min-h-[70vh] w-full flex items-center justify-center bg-[#EAE7D6] p-6">
            <div ref={exportRef} className="relative w-[1100px] max-w-[96vw] rounded-[32px] shadow-2xl" style={{ background: 'linear-gradient(145deg,#3C3C58 0%, #2c2c40 60%, #3C3C58 100%)' }}>
              <div className="rounded-[28px] border border-black/30 p-6 md:p-8">
                <div className="grid grid-cols-12 gap-6">
                  {/* LEFT */}
                  <div className="col-span-12 md:col-span-8 space-y-16">
                    {/* Main Screen */}
                    <div className="relative rounded-[18px] overflow-hidden border-8 border-[#2c2c40] shadow-inner" style={{ background: 'radial-gradient(140% 120% at 50% 20%, #A7C0B0 0%, #7DA093 45%, #547a6e 100%)' }}>
                      <div className="relative px-8 py-10 md:px-10 md:py-20" style={{ color: THEME.ink2 }}>
                        <motion.h1 key={currentStage.k + 'title'} initial={{ opacity: 0, y: noAnimMode ? 0 : 10 }} animate={{ opacity: 1, y: 0 }} transition={{ duration: 0.35 }}
                                   className="text-3xl font-extrabold" style={{ color: THEME.dark }}>
                          {currentStage.k}
                        </motion.h1>
                        <motion.p key={currentStage.k + 'text'} initial={{ opacity: 0 }} animate={{ opacity: 1 }} transition={{ delay: 0.05, duration: 0.35 }}
                                  className="mt-4 text-lg leading-relaxed">
                          {currentStage.t}
                        </motion.p>
                      </div>
                    </div>

                   {/* Subtopic Screen */}
<div className="relative rounded-[18px] overflow-hidden border-8 border-[#2c2c40] shadow-inner" style={{ background: 'radial-gradient(140% 120% at 50% 20%, #e9d9c9 0%, #EAE7D6 60%, #d7d2c2 100%)' }}>
  <div className="relative px-6 py-6 md:px-8 md:py-10 text-[#222]">
    <motion.h2 key={currentSub + 'subtitle'} initial={{ opacity: 0, y: noAnimMode ? 0 : 8 }} animate={{ opacity: 1, y: 0 }} transition={{ duration: 0.3 }}
               className="text-xl md:text-2xl font-bold" style={{ color: THEME.panelA }}>
      {currentSub}
    </motion.h2>
    <ul className="mt-3 grid gap-2 text-sm md:text-base">
      {subItems.map((a, i) => (
        <li key={i} className="flex items-start gap-2">
          <span className="mt-1 w-2 h-2 rounded-full" style={{ background: THEME.green }} />
          <span>{a}</span>
        </li>
      ))}
    </ul>
  </div>
</div>

{/* Tabs Box (separate) */}
<div className="relative rounded-[18px] overflow-hidden border shadow-inner bg-white text-[#1f1f1f]" data-snap="off">
  <div className="px-6 py-6 md:px-8 md:py-8">
    <div className="mt-0">
      <div id="tabsBar" className="flex flex-wrap gap-2">
        {Array.from({ length: 7 }).map((_, i) => (
          <button
            key={i}
            type="button"
            data-tab={i}
            onClick={() => setActiveGoalsTab(i)}
            aria-pressed={activeGoalsTab === i}
            className="px-3 py-1.5 rounded-md text-xs font-semibold border"
            style={
              activeGoalsTab === i
                ? { background: THEME.pink, color: '#fff', borderColor: THEME.pink }
                : { background: '#ffffff', color: THEME.mid, borderColor: '#cbbfb0' }
            }
          >
            {`Tab ${i + 1}`}
          </button>
        ))}
      </div>

      <div className="mt-3 rounded-lg border bg-white" style={{ borderColor: '#cbbfb0' }}>
  <div className="px-3 py-2 text-[11px] text-[#666] border-b" style={{ borderColor: '#eadfce' }}>
    {tabInfoTexts[activeGoalsTab] || `Tab ${activeGoalsTab + 1} — details for export and print.`}
  </div>

  <textarea
    className="screen-only w-full p-3 text-[14px] text-[#1f1f1f] rounded-b-lg outline-none"
    style={{ minHeight: '120px', border: 0 }}
    value={goalsTabs[activeGoalsTab] || ''}
    onChange={(e) => {
      const next = goalsTabs.slice();
      next[activeGoalsTab] = e.target.value;
      setGoalsTabs(next);
    }}
    placeholder="Enter notes for this tab…"
  ></textarea>

  <pre className="print-only whitespace-pre-wrap px-3 py-3 text-[14px] text-[#1f1f1f]">
    {(goalsTabs[activeGoalsTab] && goalsTabs[activeGoalsTab].length) ? goalsTabs[activeGoalsTab] : '(no notes entered)'}
  </pre>
</div>
    </div>
  </div>
</div>

</div> {/* <-- closes LEFT column: col-span-12 md:col-span-8 space-y-4 */}

{/* RIGHT PANEL */}
<div className="col-span-12 md:col-span-4 flex flex-col items-center justify-between pb-6">
  <div className="flex flex-col items-center w-full">
    <p className="text-white/80 text-sm mb-2">MAIN DIAL – STAGE</p>
    <motion.button aria-label="Stage knob" whileTap={noAnimMode ? undefined : { scale: 0.98 }}
      onClick={next} onContextMenu={(e) => { e.preventDefault(); prev(); }}
      ref={mainDialRef}
      className="relative w-64 h-64 rounded-full shadow-2xl focus:outline-none flex items-center justify-center"
      style={{ background: '#7DA093', border: `6px solid ${THEME.mid}` }}>
      {Array.from({ length: mainTickCount }).map((_, i) => {
        const a = baseAngle + i * (360 / mainTickCount);
        const active = i === idx;
        const h = active ? 16 : 14;
        const dist = tickDistance('main', h);
        return (
          <div key={i} className="absolute left-1/2 top-1/2"
               style={{ transform: `translate(-50%, -50%) rotate(${a}deg) translateY(-${dist}px)` }}>
            <div className={active ? 'w-[4px] h-[16px] rounded-[2px] shadow-[0_0_6px_#A7C0B0]' : 'w-[3px] h-[14px] rounded-[2px]'}
style={{ transformOrigin: 'bottom center', background: active ? '#ffffff' : '#f2f6f4', boxShadow: active ? '0 0 6px rgba(255,255,255,0.9)' : 'none' }} />
          </div>
        );
      })}
      {/* ...rest of RIGHT PANEL remains unchanged... */}

                        <div className="absolute w-full h-full flex items-center justify-center" style={{ transform: `rotate(${animatedMainAngle}deg)`, transition: 'transform 280ms cubic-bezier(0.22, 1, 0.36, 1)' }} > <div className="absolute left-1/2 top-1/2 origin-center" style={{ transform: 'translate(-50%, -50%)' }}> <div className="w-[6px] h-[90px] bg-[#D1735A] rounded-full" style={{ transformOrigin: 'bottom center', transform: 'rotate(0deg) translateY(-45px)' }} /> <div className="absolute left-1/2 top-1/2 w-[14px] h-[14px] bg-[#D1735A] rounded-full" style={{ transform: 'translate(-50%, -50%)' }} /> </div> </div>

                        <div className="absolute w-[60px] h-[60px] rounded-full shadow-inner" style={{ background: '#2f2f2f' }} />
                      </motion.button>

                      <p className="text-white/80 text-sm mt-10 mb-2">SECOND DIAL – SUB-TOPIC</p>
                      <motion.button aria-label="Sub knob" whileTap={noAnimMode ? undefined : { scale: 0.98 }}
                        onClick={nextSub} onContextMenu={(e) => { e.preventDefault(); prevSub(); }}
                        ref={subDialRef}
                        className="relative w-56 h-56 rounded-full shadow-2xl focus:outline-none flex items-center justify-center"
                        style={{ background: '#EAE7D6', border: `6px solid ${THEME.mid}` }}>
                        {Array.from({ length: subTickCount }).map((_, i) => {
                          const a = baseAngle + i * (360 / subTickCount);
                          const active = i === subIdx;
                          const h = active ? 16 : 14;
                          const dist = tickDistance('sub', h);
                          return (
                            <div key={i} className="absolute left-1/2 top-1/2"
                                 style={{ transform: `translate(-50%, -50%) rotate(${a}deg) translateY(-${dist}px)` }}>
                              <div className={active ? 'w-[4px] h-[16px] rounded-[2px] shadow-[0_0_6px_#A7C0B0]' : 'w-[3px] h-[14px] rounded-[2px]'}
style={{ transformOrigin: 'bottom center', background: active ? '#A7C0B0' : '#7DA093', boxShadow: active ? '0 0 6px #A7C0B0' : 'none' }} />
                            </div>
                          );
                        })}

                        <div className="absolute w-full h-full flex items-center justify-center" style={{ transform: `rotate(${animatedSubAngle}deg)`, transition: 'transform 260ms cubic-bezier(0.22, 1, 0.36, 1)' }} > <div className="absolute left-1/2 top-1/2 origin-center" style={{ transform: 'translate(-50%, -50%)' }}> <div className="w-[6px] h-[70px] bg-[#D1735A] rounded-full" style={{ transformOrigin: 'bottom center', transform: 'rotate(0deg) translateY(-35px)' }} /> <div className="absolute left-1/2 top-1/2 w-[12px] h-[12px] bg-[#D1735A] rounded-full" style={{ transform: 'translate(-50%, -50%)' }} /> </div> </div>

                        <div className="absolute w-[50px] h-[50px] rounded-full shadow-inner" style={{ background: '#2f2f2f' }} />
                      </motion.button>

                      <div className="mt-16 flex gap-2">
                        <button onClick={handleExportPDF} data-snap="off" className="px-4 py-2 rounded-md font-semibold text-white hover:opacity-90" style={{ background: THEME.pink }}>
  Export to PDF
</button>

</div>
                    </div>

                  
                  </div>
                </div>
              </div>

              <div className="absolute -bottom-3 left-6 right-6 h-3 rounded-b-[18px]" style={{ background:'rgba(0,0,0,0.3)' }} />
            </div>
          </div>
        );
      }

      function NegotiationDashboard() {
        const initial = [
          {
            k: 'Preparation',
            t: 'Define objectives, BATNA, and team roles. Do due diligence and set a clear agenda.',
            subs: {
              'Goals & Success Criteria': [
                'Define SMART goals for the negotiation.',
                'Separate must-haves from tradeables.',
                'List expected measurable outcomes.',
              ],
              'BATNA & Reservation': [
                'Write your BATNA in one line.',
                'Quantify your reservation point.',
                'Plan if and when to disclose BATNA.',
              ],
              'Stakeholders & Power': [
                'List all decision-makers and influencers.',
                'Identify who holds veto power.',
                'Prepare tailored benefit messages.',
              ],
              'Team & Roles': [
                'Assign chair, lead, note-taker, observer.',
                'Confirm each member’s talking points.',
                'Agree hand signals for coordination.',
              ],
		'Enter Heading 5': [
                'Enter text 1.',
                'Enter text 2.',
                'Enter text 3.',
              ],
		'Enter Heading 6': [
                'Enter text 1.',
                'Enter text 2.',
                'Enter text 3.',
              ],
		'Enter Heading 7': [
                'Enter text 1.',
                'Enter text 2.',
                'Enter text 3.',
              ],
		'Enter Heading 8': [
                'Enter text 1.',
                'Enter text 2.',
                'Enter text 3.',
              ],
		'Enter Heading 9': [
                'Enter text 1.',
                'Enter text 2.',
                'Enter text 3.',
              ],
		'Enter Heading 10': [
                'Enter text 1.',
                'Enter text 2.',
                'Enter text 3.',
              ],
            },
          },
          {
            k: 'Information Exchange',
            t: 'Build rapport, surface interests, manage information asymmetry, and signal credibly.',
            subs: {
              'Rapport & Tone': [
                'Open with professional warmth.',
                'Acknowledge common interests.',
                'Keep tone calm and collaborative.',
              ],
              'Diagnostic Questions': [
                'Ask open-ended ‘why’ and ‘how’ questions.',
                'Probe constraints without judgment.',
                'Summarize answers to show understanding.',
              ],
              'Signaling & Screening': [
                'Share one safe fact to build trust.',
                'Observe verbal and non-verbal signals.',
                'Verify key information before relying on it.',
              ],
              'Trust & Pace': [
                'Acknowledge their points clearly.',
                'Slow down if tone becomes defensive.',
                'Use pauses strategically to encourage sharing.',
              ],
            },
          },
          {
            k: 'Developing Strategy',
            t: 'Choose integrative/distributive mix. Use framing, MESOs, anchors, and contingency contracts.',
            subs: {
              'MESO Design': [
                'Create 3 equivalent package offers.',
                'Score each by cost and benefit.',
                'Record responses to learn priorities.',
              ],
              'Anchors & First Offer': [
                'Make the first offer if you have solid data.',
                'Use precise numbers for credibility.',
                'Prepare counter-anchor phrases.',
              ],
              'Framing & Influence': [
                'Use gain-oriented framing.',
                'Avoid threatening language.',
                'Support statements with legitimate standards.',
              ],
              'Concession Plan': [
                'Trade in small increments.',
                'Ask for reciprocity on every give.',
                'Note all agreed concessions in writing.',
              ],
		'Enter Heading 5': [
                'Enter text 1.',
                'Enter text 2.',
                'Enter text 3.',
              ],
		'Enter Heading 6': [
                'Enter text 1.',
                'Enter text 2.',
                'Enter text 3.',
              ],
		'Enter Heading 7': [
                'Enter text 1.',
                'Enter text 2.',
                'Enter text 3.',
              ],
		'Enter Heading 8': [
                'Enter text 1.',
                'Enter text 2.',
                'Enter text 3.',
              ],
		'Enter Heading 9': [
                'Enter text 1.',
                'Enter text 2.',
                'Enter text 3.',
              ],
		'Enter Heading 10': [
                'Enter text 1.',
                'Enter text 2.',
                'Enter text 3.',
              ],
            },
          },
          {
            k: 'Deal Making & Closing',
            t: 'Trade smartly, summarize plainly, confirm commitments, timelines, and documentation.',
            subs: {
              'Trading Questions': [
                'Ask: What’s it worth to them?',
                'Ask: What’s the cost to me?',
                'Plan what you want in return.',
              ],
              'Summarise & Confirm': [
                'Restate key points in plain language.',
                'Confirm agreement on each issue.',
                'Get verbal ‘yes’ before final sign-off.',
              ],
              'Commitments & Timelines': [
                'List who will do what by when.',
                'Document milestones and dependencies.',
                'Share final checklist for follow-up.',
              ],
              'Nibble Defence': [
                'Politely decline last-minute extras.',
                'Swap any add-ons for equal value.',
                'Close firmly once all terms are settled.',
              ],
            },
          },
          {
            k: 'Review',
            t: 'Evaluate outcomes and process, capture lessons, and reset plans for next round.',
            subs: {
              'Outcome vs Objectives': [
                'Compare results with original goals.',
                'Score value created vs captured.',
                'Note unexpected wins or losses.',
              ],
              'Bias & Process': [
                'Identify emotional or anchoring bias.',
                'Record missed signals.',
                'Rate team coordination objectively.',
              ],
              'Lessons & Playbook': [
                'Write 3 takeaways for next time.',
                'Update your negotiation template.',
                'Share lessons with your team.',
              ],
              'Renegotiation Plan': [
                'Define triggers for reopening talks.',
                'Add items for future value creation.',
                'Schedule review or follow-up meeting.',
              ],
            },
          },
        ];

        const { stages, setStages, updateStage, renameSub, updateSubItems } = useStrategyData(initial);
        const [view, setView] = useState('machine');
        const [goalsTabs, setGoalsTabs] = useState(Array(7).fill(''));

        
        React.useEffect(() => {
          window.__reactGetGoalsTabs = () => goalsTabs;
          return () => { delete window.__reactGetGoalsTabs; };
        }, [goalsTabs]);

        const saveAsHTML = React.useCallback(async () => {
  try {
    // Capture full current HTML
    let htmlText = document.documentElement.outerHTML;

    // Suggested filename with timestamp
    const d = new Date();
    const suggested = 'negotiation_dashboard_' + d.toISOString().replace(/[:.]/g, '-') + '.html';

    // Use File System Access API (Chrome/Edge)
    if (window.showSaveFilePicker) {
      try {
        const handle = await window.showSaveFilePicker({
          suggestedName: suggested,
          types: [{ description: 'HTML Files', accept: { 'text/html': ['.html'] } }]
        });
        const writable = await handle.createWritable();
        await writable.write(new Blob([htmlText], { type: 'text/html' }));
        await writable.close();
        return; // Done successfully
      } catch (err) {
        // If user cancels, stop silently
        if (!err || err.name === 'AbortError') return;
        console.warn('showSaveFilePicker failed, using fallback:', err);
      }
    }

    // Fallback for unsupported browsers
    const blob = new Blob([htmlText], { type: 'text/html' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = suggested;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
  } catch (e) {
    console.error('Save failed:', e);
    alert('Save failed: ' + e.message);
  }
}, []);

        
return (
          <div className="min-h-screen w-full text-white"
     style={{ background: 'linear-gradient(145deg,#3C3C58 0%, #2c2c40 60%, #3C3C58 100%)' }}>
            <div className="w-full max-w-6xl mx-auto px-4 py-4">
  <h1 className="text-3xl md:text-4xl font-extrabold tracking-wide text-white text-center" style={{ letterSpacing: '1px' }}>
    Negotiation Machine
  </h1>
</div>


            <NegotiationMachineRetroTV stages={stages} goalsTabs={goalsTabs} setGoalsTabs={setGoalsTabs} />
          </div>
        );
      }

      
      function buildPrintDump(tabs) {
  const c = document.createElement('div');
  c.className = 'print-dump';
  c.style.cssText = 'background:#ffffff;color:#000000;padding:16px;margin:16px;border:1px solid #ddd;border-radius:8px;';

  let html = '<div style="font-weight:700;font-size:16px;margin-bottom:10px">Negotiation Machine — Tabs</div>';

  for (let i = 0; i < tabs.length; i++) {
    const raw = tabs[i] || '(no notes entered)';
    const safe = String(raw).replace(/[&<>]/g, s => ({'&':'&amp;','<':'&lt;','>':'&gt;'}[s]));
    const t =
      (typeof tabInfoTexts !== 'undefined' && tabInfoTexts[i] && String(tabInfoTexts[i]).trim().length)
        ? String(tabInfoTexts[i]).trim()
        : 'Tab ' + (i + 1);

    html += '<div style="margin-bottom:10px;">';                                      // open
    html +=   '<div style="font-weight:600;margin-bottom:6px">' + t + '</div>';       // single heading
    html +=   '<pre style="white-space:pre-wrap;margin:0;font-size:13px;line-height:1.35">' + safe + '</pre>';
    html += '</div>';                                                                  // close
  }

  c.innerHTML = html;
  return c;
}


      (function attachPrintHooks(){
        let dump = null;
        window.addEventListener('beforeprint', function(){
          try {
            const getter = window.__reactGetGoalsTabs;
            if (typeof getter === 'function') {
              const tabs = getter();
              if (Array.isArray(tabs)) {
                dump = buildPrintDump(tabs);
                document.body.appendChild(dump);
              }
            }
          } catch (e) { /* no-op */ }
        });

        window.addEventListener('afterprint', function(){
          try {
            if (dump && dump.parentNode) dump.parentNode.removeChild(dump);
          } finally {
            dump = null;
          }
        });
      })();

const root = ReactDOM.createRoot(document.getElementById('root'));
      root.render(<NegotiationDashboard />);
    }
  </script>
</body>
</html>
